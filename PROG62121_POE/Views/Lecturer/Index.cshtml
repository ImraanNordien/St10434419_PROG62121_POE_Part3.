@model PROG62121_POE.Models.Claim
@{
    ViewData["Title"] = "Submit Monthly Claim";
    var lecturerName = ViewData["LecturerName"];
    var hourlyRate = ViewData["HourlyRate"];
    var claims = ViewData["Claims"] as List<PROG62121_POE.Models.Claim>;
}

<h2>Submit Monthly Claim</h2>

<!-- ✅ Display lecturer info -->
<p><strong>Lecturer:</strong> @lecturerName</p>
<p><strong>Hourly Rate:</strong> R<span id="hourlyRate">@hourlyRate</span></p> <!-- Added read-only display -->

<form asp-action="Index" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label>Hours Worked</label>
        <input asp-for="HoursWorked" class="form-control" id="hoursWorked" type="number" step="0.5" />
    </div>

    <!-- ✅ New: Auto-calculated total -->
    <div class="form-group">
        <label>Total Payment</label>
        <input type="text" id="totalPayment" class="form-control" readonly />
    </div>

    <div class="form-group">
        <label>Supporting Document</label>
        <input type="file" name="uploadedFile" class="form-control" />
    </div>

    <button type="submit" class="btn btn-primary">Submit Claim</button>
</form>

<hr />

<h3>Your Submitted Claims</h3>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Claim ID</th>
            <th>Hours Worked</th>
            <th>Hourly Rate</th>
            <th>Status</th>
            <th>File</th>
        </tr>
    </thead>
    <tbody>
        @if (claims != null)
        {
            foreach (var claim in claims)
            {
                <tr>
                    <td>@claim.ClaimId</td>
                    <td>@claim.HoursWorked</td>
                    <td>R @claim.HourlyRate</td>
                    <td>@claim.Status</td>
                    <td>
                        <a asp-action="Download" asp-route-fileName="@claim.FileName">Download</a>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

<!-- ✅ jQuery Script for Auto-Calculation -->
@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            const rate = parseFloat($("#hourlyRate").text()) || 0;

            $("#hoursWorked").on("input", function () {
                const hours = parseFloat($(this).val()) || 0;
                const total = hours * rate;
                $("#totalPayment").val("R " + total.toFixed(2)); // formats result nicely
            });
        });
    </script>
}
